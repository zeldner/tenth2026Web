npx create-next-app@latest lesson-02-portal
    Select these options:
    TypeScript: Yes
    ESLint: Yes
    Tailwind CSS: Yes
    src/ directory: No
    App Router: Yes (Crucial)

Install Supabase & The Cookie Helper We need supabase-js for the database and ssr (Server Side Rendering) to help the Middleware read cookies

npm install @supabase/supabase-js @supabase/ssr

We will use the same Supabase project, but we will treat the old tables (traffic, Waitlist2026) as "Do Not Touch."

Go to Supabase Dashboard -> SQL Editor. 2. Run this command to create a NEW table for this lesson:

    -- Create a new table just for Lesson 2
    create table "grades" (
    id bigint primary key generated always as identity,
    student_email text,
    course_name text,
    score int
    );

    -- Add some dummy data so we have something to see
    insert into "grades" (student_email, course_name, score)
    values 
    ('student@braude.ac.il', 'Software Engineering', 95),
    ('test@gmail.com', 'Algorithms', 88);

Create .env.local 
    In the root folder, create this file and paste your keys (same keys as last time).

        NEXT_PUBLIC_SUPABASE_URL=your_project_url_here
        NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key_here

Create the Connection File Create a folder lib and a file lib/supabase.ts. This is a slightly upgraded version that handles cookies (needed for Middleware).

The Guard (Middleware) (src/middleware.ts)

Create a file named middleware.ts in the root of the project (next to package.json).

The Login Page (app/login/page.tsx)
    What is a "Magic Link"?
    ​A Magic Link is a Passwordless Login.
    Instead of the user having to remember a secret password (like 123!), the system sends a special, one-time URL to their email. When they click that link, the website says: "Ah, since you have access to this email inbox, you must be the real owner. Welcome!"

The Admin Page (app/admin/page.tsx)
    This page is protected.  We will fetch data from the NEW table (grades) here.

The Grade Page (app/admin/grade/page.tsx)
The Upload new Grade (app/admin/upload_new-grade/page.tsx)

The Public Home Page (app/page.tsx)
    Simple links to navigate.

The Login page (app/login/page.tsx) 

The Callback Route (app/auth/callback/route.ts)

The Navbar Component (src/component/Navbar.tsx)
    Add the Navbar to the  layout.tsx (src/app/layout.tsx) 
The supabase-server (lib/supabase-server.ts) for server 
The supabase-client (hooks/useSupabase.ts) for client
Part 1: The Cookie 
    ​A Cookie is simply a tiny text file that the server gives to the browser. The browser promises to keep it and show it every time it comes back to the website.
    ​1. How is it Created?
    ​The Trigger: When the user clicks the Magic Link in their email, they hit our special route: src/app/auth/callback/route.ts.
    ​The Handshake: Our code calls supabase.auth.exchangeCodeForSession(code).
    ​The Result: Supabase validates the code and gives back a Session Token.
    ​The Storage: The createServerClient in our code takes that token and commands the browser: "Please save this text string in your cookies folder."
    ​2. Where is it saved on our computer?
    ​It is not saved as a regular file (like on our Desktop) that we can double-click. It is saved in a special Browser Storage Database inside Chrome/Edge.
    ​Physical Location (Windows): It is buried deep in C:\Users\zeldn\AppData\Local\Google\Chrome\User Data\... (Encrypted).
    ​Visual Location: We can see it by pressing F12 (Developer Tools).
    ​3. How do we send it?
    we don't have to do anything! This is the magic of browsers.
    ​Once a cookie is set for localhost:3000, the browser automatically attaches that cookie to every single request we make to that site.
    ​4. How do we delete it?
    ​When we click the "Sign Out" button (Navbar.tsx):
    Our code calls supabase.auth.signOut().
    ​Supabase sends a command to the browser: "Set the expiration date of this cookie to the year 1970."
    ​The browser sees the date is in the past and immediately deletes the file.

​Part 2: The Middleware (The "Bouncer")
    ​The Middleware is a piece of code that runs before our website even loads. It stands between the user and the page.
    ​1. Where is the code?
    ​It is located in src/middleware.ts. 
    Next.js looks for this specific file automatically.
    ​2. How it works (The Logic):
    ​Every time a user tries to load /admin:
    ​Intercept: The Middleware pauses the request.
    ​Inspect: It reads the user's Cookie.
    ​Verify: It asks Supabase: "Is this cookie valid? Is it expired? Is it fake?"
    ​Decision:
    ​If Valid: It says NextResponse.next() (Open the door).
    ​If Invalid: It says NextResponse.redirect('/login') (Kick them out).
    ​Part 3: How to see (Debug) this ourself?
    ​we can show this  using the F12 Developer Tools in Windows (Chrome or Edge).
    ​Step 1: See the Cookie
    ​Open Our site and Log in.
    ​Press F12 on our keyboard.
    ​Go to the Application tab (at the top).
    ​On the left sidebar, open Cookies -> http://localhost:3000.
    We will see a row starting with sb- (e.g., sb-access-token). That is the cookie.
    ​Experiment: If we right-click and "Delete" it, and then refresh the page, the Middleware will kick us out!
    ​Step 2: See the "Handshake" (Network)
    ​Go to the Network tab in F12.
    ​Refresh the page.
    ​Click on the first request (localhost).
    ​Look at the Headers section on the right.
    ​Scroll down to Request Headers. We will see a line saying Cookie: sb-access-token=....
    ​This proves our browser is sending the secret key to the server.


